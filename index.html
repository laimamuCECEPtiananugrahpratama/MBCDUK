<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBCDUK: Definitive Edition</title>
    <style>
        /* =========================================
           1. CORE VISUALS & RESET
           ========================================= */
        :root {
            --neon-green: #39ff14;
            --blood-red: #880000;
            --ui-bg: #111;
            --scanline-color: rgba(0, 0, 0, 0.5);
        }

        body {
            margin: 0;
            background-color: #050505;
            color: #ccc;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            user-select: none;
        }

        /* CRT & NOISE EFFECTS */
        #crt-layer {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none; z-index: 999;
        }

        #vignette {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: radial-gradient(circle, transparent 40%, black 90%);
            pointer-events: none; z-index: 998;
        }

        #noise-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0.05; pointer-events: none; z-index: 997;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* UTILS */
        .hidden { display: none !important; }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        .flicker { animation: flicker 0.1s infinite; }
        .glitch-text { animation: glitch-skew 1s infinite linear alternate-reverse; }

        /* =========================================
           2. MAIN MENU (FNAF STYLE)
           ========================================= */
        #menu-screen {
            width: 100vw; height: 100vh;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            position: relative; z-index: 100;
        }

        .menu-title {
            font-size: 4rem; color: var(--blood-red);
            text-shadow: 2px 2px 0px #fff; letter-spacing: 5px;
            margin-bottom: 20px; text-align: center;
        }

        .menu-bg-anim {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0.2; z-index: -1;
            display: flex; justify-content: center; align-items: center;
        }

        /* Animasi Latar Menu: Kotak, Bulat, Segitiga, Hati */
        #menu-shape {
            width: 300px; height: 300px;
            background: #333;
            transition: all 0.2s;
        }

        .btn-menu {
            background: transparent; border: 2px solid #555;
            color: #eee; padding: 15px 40px; font-size: 1.5rem;
            cursor: pointer; font-family: inherit; margin-top: 50px;
            transition: 0.2s;
        }
        .btn-menu:hover { background: var(--blood-red); border-color: #f00; color: #fff; }

        /* =========================================
           3. GAME WORLD (3D SPACE)
           ========================================= */
        #game-container {
            perspective: 800px; width: 100vw; height: 100vh;
            background: #080808; overflow: hidden;
        }

        #camera {
            width: 100%; height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.4s ease-out; /* Smooth look */
        }

        .wall {
            position: absolute; width: 1000px; height: 800px;
            top: 50%; left: 50%;
            background: #111; border: 1px solid #222;
            display: flex; justify-content: center; align-items: center;
        }

        /* Mapping Ruangan */
        #wall-center { transform: translate(-50%, -50%) translateZ(0px); }
        #wall-left   { transform: translate(-50%, -50%) rotateY(90deg) translateZ(500px) translateX(-500px); background: #0c0c0c; }
        #wall-right  { transform: translate(-50%, -50%) rotateY(-90deg) translateZ(500px) translateX(500px); background: #0c0c0c; }

        /* --- ENTITAS (ANOMALI) --- */
        .entity {
            transition: opacity 1s; opacity: 0;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.8));
        }

        /* CECEP (Kanan): Persegi Panjang Besar */
        #cecep-visual {
            width: 150px; height: 350px; background: #1a1a1a;
            border: 2px solid #222; box-shadow: inset 0 0 20px #000;
            position: relative;
        }
        #cecep-visual::after { /* Mata Merah */
            content: ''; position: absolute; top: 60px; left: 40px;
            width: 15px; height: 15px; background: red;
            box-shadow: 50px 0 0 red; border-radius: 50%;
            animation: flicker 2s infinite;
        }

        /* BIBIN (Kiri): Bulat Cepat */
        #bibin-visual {
            width: 180px; height: 180px; background: #2b1111;
            border-radius: 50%; border: 5px dashed #400;
            animation: spin 2s infinite linear;
        }

        /* WILSON (Kanan/Kiri): Segitiga */
        #wilson-visual {
            width: 0; height: 0;
            border-left: 80px solid transparent; border-right: 80px solid transparent;
            border-bottom: 220px solid #111133;
        }

        /* =========================================
           4. PHONE UI
           ========================================= */
        #phone-wrapper {
            position: absolute; bottom: -30px; left: 50%;
            transform: translateX(-50%);
            width: 320px; height: 550px;
            background: #222; border-radius: 30px 30px 0 0;
            border: 8px solid #333; border-bottom: none;
            z-index: 50; transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #phone-screen {
            margin: 15px; height: 85%; background: #001500;
            border-radius: 5px; padding: 10px;
            color: var(--neon-green);
            display: flex; flex-direction: column;
            position: relative; overflow: hidden;
            border: 2px inset #111;
        }

        /* Elemen HP */
        .bar-container { width: 100%; height: 15px; background: #003300; margin: 5px 0; border: 1px solid var(--neon-green); }
        .bar-fill { width: 0%; height: 100%; background: var(--neon-green); transition: width 0.2s; }
        
        #cook-btn {
            background: #004400; color: #fff; border: 2px solid var(--neon-green);
            padding: 20px; margin-top: auto; cursor: pointer;
            font-weight: bold; font-family: inherit; font-size: 1.2rem;
            text-transform: uppercase;
        }
        #cook-btn:active { background: var(--neon-green); color: #000; }

        #power-btn {
            position: absolute; top: 10px; right: 10px;
            width: 30px; height: 30px; border-radius: 50%;
            background: #300; border: 1px solid red;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            color: red; font-size: 10px;
        }

        /* STARBYNA GLITCH MODE */
        .starbyna-mode {
            background: #300 !important;
            color: #f0f !important;
        }
        .starbyna-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            font-size: 8rem; color: #f0f; z-index: 60;
            animation: glitch-skew 0.2s infinite; pointer-events: none;
            mix-blend-mode: overlay;
        }

        /* =========================================
           5. HUD & CUES
           ========================================= */
        .cue-text {
            position: absolute; top: 30%; width: 100%; text-align: center;
            font-size: 2rem; color: #444; font-weight: bold; opacity: 0;
            transition: opacity 0.3s;
        }
        
        #nav-guide {
            position: fixed; bottom: 10px; width: 100%; text-align: center;
            font-size: 12px; color: #555; z-index: 101; pointer-events: none;
        }

        /* Game Over Screen */
        #game-over {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; color: red;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 2000;
        }

        /* ANIMATIONS */
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes glitch-skew { 0% { transform: skew(0deg); } 20% { transform: skew(-10deg); } 40% { transform: skew(10deg); } 60% { transform: skew(-5deg); } 80% { transform: skew(5deg); } 100% { transform: skew(0deg); } }

    </style>
</head>
<body>

    <div id="crt-layer"></div>
    <div id="vignette"></div>
    <div id="noise-overlay"></div>

    <div id="menu-screen">
        <div class="menu-bg-anim">
            <div id="menu-shape"></div>
        </div>
        <h1 class="menu-title">M.B.C.D.U.K<br><span style="font-size:1.5rem">NIGHTMARE SHIFT</span></h1>
        <button class="btn-menu" onclick="startGame()">MULAI KERJA (COOK)</button>
        <p style="margin-top:20px; font-size:12px; color:#555">Headphones Recommended</p>
    </div>

    <div id="game-over" class="hidden">
        <h1 style="font-size: 5rem;">MATI</h1>
        <p id="death-reason">KARENA KEBODOHAN</p>
        <button class="btn-menu" onclick="location.reload()">COBA LAGI</button>
    </div>

    <div id="game-container" class="hidden">
        <div id="camera">
            
            <div class="wall" id="wall-left">
                <div class="cue-text" id="cue-left">! ! !</div>
                <div id="bibin-visual" class="entity"></div>
            </div>

            <div class="wall" id="wall-center">
                </div>

            <div class="wall" id="wall-right">
                <div class="cue-text" id="cue-right">? ? ?</div>
                <div id="cecep-visual" class="entity"></div>
                <div id="wilson-visual" class="entity" style="position: absolute; bottom: 0; left: 200px;"></div>
            </div>

        </div>
    </div>

    <div id="phone-wrapper" class="hidden">
        <div id="phone-screen">
            <div id="power-btn" onclick="togglePower()">P</div>
            
            <div id="ui-normal">
                <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:10px;">
                    <span>03:00 AM</span>
                    <span id="battery-stat">90%</span>
                </div>
                
                <div style="text-align:center; margin-top:20px;">
                    <h3>UJANGKEDU.EXE</h3>
                    <p>COOKING PROGRESS</p>
                    <h1 id="progress-text" style="font-size:3rem; margin:10px 0;">0%</h1>
                    <div class="bar-container">
                        <div class="bar-fill" id="progress-bar"></div>
                    </div>
                </div>

                <div id="cook-btn" onclick="cookAction()">COOK NOW</div>
            </div>

            <div id="starbyna-overlay" class="starbyna-overlay hidden">♥</div>
            
            <div id="screen-off" class="hidden" style="width:100%; height:100%; background:black; position:absolute; top:0; left:0; z-index:100; display:flex; justify-content:center; align-items:center; color:#333;">
                SYSTEM OFF...
            </div>
        </div>
    </div>

    <div id="nav-guide" class="hidden">
        [A / KIRI] Cek Belakang &nbsp; | &nbsp; [S / BAWAH] Main HP &nbsp; | &nbsp; [D / KANAN] Cek Depan
    </div>

<script>
    /* =========================================
       GAME LOGIC
       ========================================= */
    
    // State
    let gameState = "MENU"; // MENU, PLAY, OVER
    let playerPos = "CENTER"; // LEFT, CENTER, RIGHT
    let phoneOn = true;
    let progress = 0;
    
    // Difficulty Settings
    let aiInterval;
    let threats = {
        cecep: 0,   // 0:Idle, 1:Cue, 2:Ready, 3:Attack
        bibin: 0,
        wilson: 0,
        starbyna: 0 // 0:Idle, 1:Active (Glitch)
    };
    let starbynaTimer = null;

    // DOM Caching
    const els = {
        menu: document.getElementById('menu-screen'),
        game: document.getElementById('game-container'),
        phone: document.getElementById('phone-wrapper'),
        camera: document.getElementById('camera'),
        progressBar: document.getElementById('progress-bar'),
        progressText: document.getElementById('progress-text'),
        starOverlay: document.getElementById('starbyna-overlay'),
        screenOff: document.getElementById('screen-off'),
        navGuide: document.getElementById('nav-guide'),
        phoneScreen: document.getElementById('phone-screen'),
        shape: document.getElementById('menu-shape'),
        gameOver: document.getElementById('game-over'),
        reason: document.getElementById('death-reason')
    };

    // --- 1. MENU ANIMATION LOOP ---
    // Pattern: Kotak -> Bulat -> Segitiga -> (Loop: Kotak+Hati, Bulat, Segitiga)
    let shapeIdx = 0;
    const shapes = [
        { r: '0%', c: '#333' }, // Kotak
        { r: '50%', c: '#444' }, // Bulat
        { r: '0%', clip: 'polygon(50% 0%, 0% 100%, 100% 100%)', c: '#222' } // Segitiga
    ];

    setInterval(() => {
        if(gameState !== "MENU") return;
        
        // Reset Styles
        els.shape.style.borderRadius = '0';
        els.shape.style.clipPath = 'none';
        els.shape.style.background = '#333';
        els.shape.innerHTML = '';

        let currentShape = shapes[shapeIdx % 3];
        
        // Apply Shape
        if(currentShape.clip) els.shape.style.clipPath = currentShape.clip;
        else els.shape.style.borderRadius = currentShape.r;
        els.shape.style.background = currentShape.c;

        // Special Phase: Kotak + Hati (setelah putaran pertama)
        if(shapeIdx >= 3 && (shapeIdx % 3 === 0)) {
            els.shape.innerHTML = '<div style="font-size:100px; color:#500; display:flex; justify-content:center; align-items:center; height:100%;">♥</div>';
        }

        shapeIdx++;
    }, 1000);

    // --- 2. GAME START ---
    function startGame() {
        gameState = "PLAY";
        els.menu.classList.add('hidden');
        els.game.classList.remove('hidden');
        els.phone.classList.remove('hidden');
        els.navGuide.classList.remove('hidden');

        // Start AI Director
        aiInterval = setInterval(directorAI, 2000); // Cek setiap 2 detik
    }

    // --- 3. CONTROLS ---
    function setPosition(pos) {
        if(gameState !== "PLAY") return;
        playerPos = pos;

        if(pos === 'CENTER') {
            els.camera.style.transform = "rotateY(0deg)";
            els.phone.style.bottom = "-30px";
            checkClearVisuals(); // Player melihat, apakah musuh hilang?
        } else if (pos === 'LEFT') {
            els.camera.style.transform = "translateX(400px) rotateY(90deg)";
            els.phone.style.bottom = "-600px";
            checkClearVisuals();
        } else if (pos === 'RIGHT') {
            els.camera.style.transform = "translateX(-400px) rotateY(-90deg)";
            els.phone.style.bottom = "-600px";
            checkClearVisuals();
        }
    }

    window.addEventListener('keydown', (e) => {
        if(e.key === 'a' || e.key === 'ArrowLeft') setPosition('LEFT');
        if(e.key === 'd' || e.key === 'ArrowRight') setPosition('RIGHT');
        if(e.key === 's' || e.key === 'ArrowDown') setPosition('CENTER');
    });

    // --- 4. PHONE MECHANICS ---
    function togglePower() {
        phoneOn = !phoneOn;
        if(!phoneOn) {
            els.screenOff.classList.remove('hidden');
            // CURE STARBYNA
            if(threats.starbyna === 1) {
                threats.starbyna = 0;
                clearTimeout(starbynaTimer);
                els.starOverlay.classList.add('hidden');
                els.phoneScreen.classList.remove('starbyna-mode');
                console.log("Starbyna Hilang");
            }
        } else {
            els.screenOff.classList.add('hidden');
        }
    }

    function cookAction() {
        if(!phoneOn || gameState !== "PLAY") return;

        if(threats.starbyna === 1) {
            // HUKUMAN JIKA MASAK SAAT ADA STARBYNA
            progress -= 5;
            if(progress < 0) progress = 0;
            triggerGlitch();
        } else {
            progress += 2; // Normal progress
        }

        if(progress >= 100) winGame();
        updateUI();
    }

    function updateUI() {
        els.progressText.innerText = Math.floor(progress) + "%";
        els.progressBar.style.width = progress + "%";
    }

    function triggerGlitch() {
        els.phone.style.transform = "translateX(-50%) skewX(10deg)";
        setTimeout(() => els.phone.style.transform = "translateX(-50%) skewX(0deg)", 100);
    }

    // --- 5. AI DIRECTOR (LOGIC MUSUH) ---
    function directorAI() {
        if(progress >= 100) return;

        let roll = Math.random();
        
        // Difficulty Scaling: Makin tinggi progress, makin sering muncul
        let aggression = 0.2 + (progress / 200); // 0.2 to 0.7

        // CECEP (KANAN)
        if(threats.cecep === 0 && roll < aggression) {
            threats.cecep = 1; // Cue
            showCue('right', "BERAT...");
            document.body.classList.add('shake');
            setTimeout(() => document.body.classList.remove('shake'), 500);
        } 
        else if (threats.cecep === 1) {
            threats.cecep = 2; // Muncul
            document.getElementById('cecep-visual').style.opacity = 1;
        }
        else if (threats.cecep === 2) {
            threats.cecep = 3; // Attack Phase
        }

        // BIBIN (KIRI)
        if(threats.bibin === 0 && roll > (1-aggression)) {
            threats.bibin = 1; // Cue
            showCue('left', "TAP TAP TAP");
            document.getElementById('wall-left').classList.add('flicker');
        }
        else if (threats.bibin === 1) {
            threats.bibin = 2; // Muncul
            document.getElementById('wall-left').classList.remove('flicker');
            document.getElementById('bibin-visual').style.opacity = 1;
        }
        else if (threats.bibin === 2) {
            threats.bibin = 3; // Attack Phase
        }

        // STARBYNA (HP) - Hanya muncul jika progress > 30%
        if(threats.starbyna === 0 && progress > 30 && roll < 0.1 && phoneOn) {
            activateStarbyna();
        }

        // CHECK DEATH
        checkDeathCondition();
    }

    // --- 6. ANOMALY MECHANICS ---
    function activateStarbyna() {
        threats.starbyna = 1;
        els.starOverlay.classList.remove('hidden');
        els.phoneScreen.classList.add('starbyna-mode');
        
        // Kill player in 8 seconds if phone not turned off
        starbynaTimer = setTimeout(() => {
            if(threats.starbyna === 1 && phoneOn) {
                gameOver("STARBYNA MENCURI JIWAMU");
            }
        }, 8000);
    }

    function showCue(side, text) {
        let el = document.getElementById('cue-' + side);
        el.innerText = text;
        el.style.opacity = 1;
    }

    function checkClearVisuals() {
        // Pemain melihat ke arah yang benar saat musuh terlihat (Fase 2)
        
        // Clear Cecep
        if(playerPos === 'RIGHT' && threats.cecep === 2) {
            threats.cecep = 0;
            document.getElementById('cecep-visual').style.opacity = 0;
            document.getElementById('cue-right').style.opacity = 0;
            console.log("Cecep Mundur");
        }

        // Clear Bibin
        if(playerPos === 'LEFT' && threats.bibin === 2) {
            threats.bibin = 0;
            document.getElementById('bibin-visual').style.opacity = 0;
            document.getElementById('cue-left').style.opacity = 0;
            console.log("Bibin Kabur");
        }
    }

    function checkDeathCondition() {
        // Kalau Cecep Fase 3 dan player tidak melihat Kanan -> Mati
        if(threats.cecep === 3 && playerPos !== 'RIGHT') {
            gameOver("CECEP MEREMUKKANMU");
        }
        // Kalau Bibin Fase 3 dan player tidak melihat Kiri -> Mati
        if(threats.bibin === 3 && playerPos !== 'LEFT') {
            gameOver("BIBIN TERLALU CEPAT");
        }
    }

    function gameOver(reason) {
        gameState = "OVER";
        clearInterval(aiInterval);
        clearTimeout(starbynaTimer);
        
        els.game.classList.add('hidden');
        els.phone.classList.add('hidden');
        els.gameOver.classList.remove('hidden');
        els.reason.innerText = reason;
    }

    function winGame() {
        gameState = "OVER";
        clearInterval(aiInterval);
        alert("PAGI TELAH TIBA. UJANGKEDU MATANG SEMPURNA.");
        location.reload();
    }

</script>
</body>
</html>